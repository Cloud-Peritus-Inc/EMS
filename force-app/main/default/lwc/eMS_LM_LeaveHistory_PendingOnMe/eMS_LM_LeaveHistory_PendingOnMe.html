<!--
  @description       : This component is used to show the Leave History in Pending On Me Tab For current Logged in Employee
  @author            : Pavan
  @group             : 
  @last modified on  : 02-02-2023
  @last modified by  : 
-->

<template>
	<div class="font">
		<lightning-card>
			<div slot="actions">
				<lightning-button variant="destructive" label="Select All" title="Select All" onclick={handleSelectAll}>
				</lightning-button>
				&nbsp;&nbsp;
				<lightning-button variant="success" label="Approve All" title="Approve ALl" onclick={handleApproveAll}>
				</lightning-button>
				&nbsp;&nbsp;
				<lightning-button variant="destructive" label="Reject All" title="Reject All" onclick={handleRejectAll}>
				</lightning-button>
			</div>
			<lightning-layout multiple-rows>
				<lightning-layout-item padding="around-small" size="2">
					<div>
						<lightning-input type="text" label="Employee" value={empName} onchange={namechange}>
						</lightning-input>
					</div>
				</lightning-layout-item>
				<lightning-layout-item padding="around-small" size="2">
					<div>
						<lightning-input type="Date" label="Start Date" value={startDate} onchange={startdatechange}>
						</lightning-input>
					</div>
				</lightning-layout-item>
				<lightning-layout-item padding="around-small" size="2">
					<div>
						<lightning-input type="Date" label="End Date" value={endDate} onchange={enddatechange}>
						</lightning-input>
					</div>
				</lightning-layout-item>
				<lightning-layout-item padding="around-small" size="2">
					<div>
						<c-multi-select-picklist if:true={leaveTypeValues} options={leaveTypeValues}
							onvaluechange={handleTypeValueChange} label="Leave Type">
						</c-multi-select-picklist>
					</div>
				</lightning-layout-item>
				<lightning-layout-item padding="around-small" size="2">
					<div>
						<c-multi-select-picklist if:true={picklistValues} options={picklistValues}
							onvaluechange={handleValueChange} label="Leave Status">
						</c-multi-select-picklist>
					</div>
				</lightning-layout-item>
			</lightning-layout>
			<template if:true={showdata}>
				<lightning-card>
					<table>
						<thead>
							<tr style="border-top:1px solid #d4d4d4;border-bottom:1px solid #d4d4d4">
								<th style="padding:12px">
									<div> </div>
								</th>
								<th>
									<div title="User Name">Employee Name</div>
								</th>
								<th>
									<div title="Leave Type">Leave Type</div>
								</th>
								<th>
									<div title="Leave Start Date">Leave Start Date</div>
								</th>
								<th>
									<div title="Leave End Date">Leave End Date</div>
								</th>
								<th>
									<div title="Leave Duration">Leave Duration</div>
								</th>
								<th>
									<div title="Reason">Reason</div>
								</th>
								<th>
									<div title="Approver">Approver</div>
								</th>
								<th>
									<div title="Leave Status">Leave Status</div>
								</th>
								<th>
									<div title="Approved On">Approved On</div>
								</th>
								<th class="slds-cell_action-mode" style="width:3.25rem">
									<div class="slds-truncate slds-assistive-text" title="Actions">Actions</div>
								</th>
							</tr>
						</thead>
						<tbody>
							<template for:each={datahistory} for:item="Req">
								<tr key={Req.Id} style="border-bottom:1px solid #d4d4d4">
									<td style="padding:7px">
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											<input type="checkbox" id="checkbox-unique-id-81" name="label" onchange={handleSelect} data-id={Req.Id} data-record-id={Req.id}/>
									</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Contact__r.Name}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Leave_Type_Name__c }</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Leave_Start_Date__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Leave_End_Date__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Leave_Duration__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Reason__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Current_Approver__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Status__c}</div>
									</td>
									<td>
										<div class="slds-truncate dv-dynamic-width" style={fixedWidth}>
											{Req.EMS_LM_Approved_On__c}</div>
									</td>
									<td class="slds-cell_action-mode" role="gridcell">
										<lightning-button-menu alternative-text="Show menu"
											icon-name="utility:threedots_vertical" variant="container"
											menu-alignment="right" onclick={handleCancelButton}
											data-value={Req.EMS_LM_Status__c} data-record-id={Req.Id}>
											<!--template if:true={showcancelbutton}-->
											<lightning-menu-item value="View" label="View" onclick={handleView}
												data-value={Req.EMS_LM_Status__c} key-field={Req.Id}
												data-record-id={Req.Id} data-id={Req.Id}>
											</lightning-menu-item>
											<lightning-menu-item value="Approve" label="Approve"
												onclick={showModalApprovalBox} data-value={Req.EMS_LM_Status__c}
												key-field={Req.Id} data-record-id={Req.Id} data-id={Req.Id}>
											</lightning-menu-item>
											<lightning-menu-item value="Reject" label="Reject"
												onclick={showModalRejectBox} data-value={Req.EMS_LM_Status__c}
												key-field={Req.Id} data-record-id={Req.Id} data-id={Req.Id}>
											</lightning-menu-item>
											<!--/template-->
										</lightning-button-menu>
									</td>
								</tr>
							</template>
						</tbody>
					</table>
				</lightning-card>
			</template>
			<!-- APPROVE ALL POP-UP-->
			<template if:true={isShowModalApproveAll}>
				<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
					aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
					<div class="slds-modal__container">
						<!-- modal header start -->
						<header class="slds-modal__header">
							<h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
								Confirmation</h2>
						</header>

						<!-- modal body start -->
						<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
							<p style="font-size:20px;">Please Enter the Approve Comments</p><br>
							<lightning-textarea name="input" required value="" placeholder="Type comments here..."
								label="Comments" maxlength="140"
								message-when-too-long="A maximum of 140 characters are allowed."
								message-when-value-missing="Please add comments." onchange={handleApproveAllComments}>
							</lightning-textarea>
						</div>

						<!-- modal footer start-->
						<footer class="slds-modal__footer">

							<button class="slds-button slds-button_neutral" onclick={handleCloseAll}
										>Cancel</button>
							<button class="slds-button slds-button_neutral" onclick={handleApproveAllSave}
										>Save</button>
						</footer>
					</div>
				</section>
				<div key={Req.Id} class="slds-backdrop slds-backdrop_open"></div>

			</template>
			<!-- REJECT ALL POP-UP-->
			<template if:true={isShowModalRejectAll}>
				<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-02" aria-modal="true"
					aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
					<div class="slds-modal__container">
						<!-- modal header start -->
						<header class="slds-modal__header">
							<h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">
								Confirmation</h2>
						</header>

						<!-- modal body start -->
						<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
							<p style="font-size:20px;">Please Enter the Reject Comments</p><br>
							<lightning-textarea name="input" required value={rejectComments}
								placeholder="Type comments here..." label="Comments" maxlength="140"
								message-when-too-long="A maximum of 140 characters are allowed."
								message-when-value-missing="Please add comments." onchange={handleRejectAllComments}
								class="isRequired" data-id="validateValue">
							</lightning-textarea>
						</div>

						<!-- modal footer start-->
						<footer class="slds-modal__footer">

							<button class="slds-button slds-button_neutral" onclick={handleCloseAll}
										>Cancel</button>
							<button class="slds-button slds-button_neutral" onclick={handleRejectAllSave}
										>Save</button>
						</footer>
					</div>
				</section>
				<div key={Req.Id} class="slds-backdrop slds-backdrop_open"></div>
			</template>

			<!-- APPROVE  POP-UP-->
			<template if:true={isShowModalApprove}>
				<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-03" aria-modal="true"
					aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
					<div class="slds-modal__container">
						<!-- modal header start -->
						<header class="slds-modal__header">
							<h2 id="modal-heading-03" class="slds-text-heading_medium slds-hyphenate">
								Confirmation</h2>
						</header>

						<!-- modal body start -->
						<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-3">
							<p style="font-size:20px;">Please Enter the Approve Comments</p><br>
							<lightning-textarea name="input" required value="" placeholder="Type comments here..."
								label="Comments" maxlength="140"
								message-when-too-long="A maximum of 140 characters are allowed."
								message-when-value-missing="Please add comments." onchange={handleApproveComments}>
							</lightning-textarea>
						</div>

						<!-- modal footer start-->
						<footer class="slds-modal__footer">

							<button class="slds-button slds-button_neutral" onclick={handleCloseAll}
										>Cancel</button>
							<button class="slds-button slds-button_neutral" onclick={handleApproveSave}
										>Save</button>
						</footer>
					</div>
				</section>
				<div key={Req.Id} class="slds-backdrop slds-backdrop_open"></div>
			</template>
			<!-- REJECT  POP-UP-->
			<template if:true={isShowModalReject}>
				<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-02" aria-modal="true"
					aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
					<div class="slds-modal__container">
						<!-- modal header start -->
						<header class="slds-modal__header">
							<h2 id="modal-heading-04" class="slds-text-heading_medium slds-hyphenate">
								Confirmation</h2>
						</header>

						<!-- modal body start -->
						<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-4">
							<p style="font-size:20px;">Please Enter the Reject Comments</p><br>
							<lightning-textarea name="input" required value={rejectComments}
								placeholder="Type comments here..." label="Comments" maxlength="140"
								message-when-too-long="A maximum of 140 characters are allowed."
								message-when-value-missing="Please add comments." onchange={handleRejectComments}
								class="isRequired" data-id="validateValue">
							</lightning-textarea>
						</div>

						<!-- modal footer start-->
						<footer class="slds-modal__footer">

							<button class="slds-button slds-button_neutral" onclick={handleCloseAll}
										>Cancel</button>
							<button class="slds-button slds-button_neutral" onclick={handleRejectSave}
										>Save</button>
						</footer>
					</div>
				</section>
				<div key={Req.Id} class="slds-backdrop slds-backdrop_open"></div>
			</template>


		</lightning-card>
		<template if:true={nodata}>
			<h2> No Requests Found.</h2>
		</template>
	</div>
</template>