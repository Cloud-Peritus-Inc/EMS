<template>
	<lightning-card>
		<div class="tableFixHead">
			<table class="slds-table_cell-buffer slds-no-row-hover slds-table_bordered fixed_header">
				<thead>
					<tr style="color:lightcoral">
						<th class="slds-border_right tableheading" scope="col" style="width: 5%;">
							<div class="slds-truncate" title="KRA Name">KRA Name</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 15%;">
							<div class="slds-truncate" title="Project Name">Project Name</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 15%;">
							<div class="slds-truncate" title="Resource Name">Resource Name</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 15%;">
							<div class="slds-truncate" title="Requested By">Requested By</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 5% !important;">
							<div class="slds-truncate" title="Project Onboarding Date">Project Onboarding Date</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 5% !important;">
							<div class="slds-truncate" title="Project Offboarding Date">Project Offboarding Date</div>
						</th>
						<th class="slds-border_right tableheading" scope="col" style="width: 15%;">
							<div class="slds-truncate" title="Actions"> Actions </div>
						</th>
					</tr>
				</thead>

				<tbody>
					<template if:true={hasData}>
						<template for:each={data} for:item="goal" for:index="index">
							<tr key={goal.Id}>
								<td style="word-wrap:break-word; width: 10%;">
									<div class="slds-wrap">{goal.goalName}</div>
								</td>
								<td style="word-wrap:break-word; width: 15%;">
									<div class="slds-wrap">{goal.ProjectName}</div>
								</td>
								<td style="width: 15%;">
									<div class="slds-wrap">
										<div class="slds-wrap">
											<lightning-formatted-text value={goal.resourceName} ></lightning-formatted-text>
										</div>
									</div>
								</td>
								<td style="width: 15%;">
									<div class="slds-wrap">
										<div class="slds-wrap">
											<lightning-formatted-text value={goal.requestedByName} ></lightning-formatted-text>
										</div>
									</div>
								</td>
								<td style="width: 15%;">
									<div class="slds-wrap">
										<lightning-formatted-date-time value={goal.startDate}>
										</lightning-formatted-date-time>
									</div>
								</td>
								<td style="width: 15%;">
									<div class="slds-wrap">
										<lightning-formatted-date-time value={goal.endDate}>
										</lightning-formatted-date-time>
									</div>
								</td>
								<td class="slds-text-align_center slds-p-around_medium">
									<template if:false={goal.hideEditBtn}>
										<lightning-button-icon icon-name="action:edit" size="large" variant="bare" alternative-text="Edit KRA" data-index={index} onclick={editKRAModalPopUp} class="slds-m-left_xx-small"></lightning-button-icon>
									</template>		
									<template if:false={goal.hideRejectBtn}>						
										<lightning-button variant="destructive" label="Reject" data-id={goal.Id} data-index={index} onclick={rejectRequestHandler}></lightning-button>
									</template>
									<template if:false={goal.hideAcceptBtn}>
										<lightning-button variant="success" label="Accept" data-id={goal.Id} data-index={index} onclick={acceptRequestHandler}></lightning-button>
									</template>
									<template if:true={isShowPopUp}>
										<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01"
											aria-modal="true" aria-describedby="modal-content-id-1"
											class="slds-modal slds-fade-in-open">
											<div class="slds-modal__container">
												<header class="slds-modal__header">
													<button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideModalBox}>
                										<lightning-icon icon-name="utility:close"
                   														alternative-text="close"
                   														variant="inverse"
                   														size="small" ></lightning-icon>
                													<span class="slds-assistive-text">Close</span>
             										</button>
													<h2 id="modal-heading-01"
														class="slds-text-heading_medium slds-hyphenate">Rejection Reason</h2>
												</header>
												<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
													<lightning-textarea variant="label-stacked" required label="Enter rejection reason" value={comment} onchange={handleCommentChange} field-level-help="Rejection reason for declining the KRA request"></lightning-textarea>
													<template if:true={showError}>
														<div class="slds-text-color_error" style="margin-top: 0.5rem;">Please Enter a Rejection Reason.</div>
													</template>
												</div>
												<footer class="slds-modal__footer">
													<button class="slds-button slds-button_neutral" onclick={handleRejectionSubmission}>Submit</button>
												</footer>
											</div>
										</section>
										<div class="slds-backdrop slds-backdrop_open"></div>
									</template>

									<template if:true={showKRAEditModal}>
										<lightning-card>
											<section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
												aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
												<div class="slds-modal__container">													
													<header class="slds-modal__header">
														<button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideKRAEditModalBox}>
									                <lightning-icon icon-name="utility:close"
									                   alternative-text="close"
									                   variant="inverse"
									                   size="small" ></lightning-icon>
									                <span class="slds-assistive-text">Close</span>
									             </button>
														<h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">Quarterly KRA Edit</h2>
													</header>																					
													<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
														<!-- onclose={hideKRAEditModalBox} -->														
														<c-quarterlykraedit mode={mode} selected-project-id ={selectedProjectId} receivedkraid={selectedKraQuaterly} selectedresource={selectedResourceId} tab={tab} onmycustomevent={handleCustomEvent}> </c-quarterlykraedit>
													</div>																					
													<footer class="slds-modal__footer">									
														<button class="slds-button slds-button_neutral" title="Close" onclick={hideKRAEditModalBox}>Close</button>
													</footer>							
												</div>
											</section>
											<div class="slds-backdrop slds-backdrop_open"></div>
										</lightning-card>
									</template>
								</td>
							</tr>
						</template>
					</template>
				</tbody>
			</table>

			<template if:false={hasData}>
				<div class="slds-text-align_center slds-p-around_medium">
					<center>No KRA records found.</center>
				</div>
			</template>
		</div>
	</lightning-card>
</template>